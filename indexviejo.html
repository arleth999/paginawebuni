<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tienda Online A&A</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  
</head>
<body>
  <nav class="navbar navbar-dark bg-dark sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Tienda Online A&A</a>
      <a href="https://arleth999.github.io/paginawebuni/parcial.html">Link Primer Parcial</a>
     <div class="d-flex">
        <div class="cart-icon me-3">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-badge">3</span>
        </div>
      </div>
    </div>
  </nav>
  <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img src="https://picsum.photos/1200/300?random=1" class="d-block w-100" alt="Promo 1">
      </div>
      <div class="carousel-item">
        <img src="https://picsum.photos/1200/300?random=2" class="d-block w-100" alt="Promo 2">
      </div>
      <div class="carousel-item">
        <img src="https://picsum.photos/1200/300?random=3" class="d-block w-100" alt="Promo 3">
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
    </button>
  </div>
  <div class="container my-4">
    <div class="row">
      <div class="col-sm-3">
        <h5>Categorías</h5>
        <ul id="list-group"  class="list-group">
        </ul>
      </div>

      
<div class="col-sm-9">
  <div class="row" id="contenedor-productos"></div>
</div>


    </div>
  </div>

  
  <footer class="bg-dark text-white text-center py-3">
      Arleth López- 1890-17-23444
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


  <script>
(async () => {
  const url = "https://backcvbgtmdesa.azurewebsites.net/api/productos";
  const contenedor = document.getElementById("contenedor-productos");

  
  contenedor.innerHTML = `
    <div class="col-12">
      <div class="alert alert-info">Cargando productos...</div>
    </div>`;

  try {
    const resp = await fetch(url, { headers: { "Accept": "application/json" } });
    if (!resp.ok) throw new Error("HTTP " + resp.status);

    const productos = await resp.json();

    if (!Array.isArray(productos) || productos.length === 0) {
      contenedor.innerHTML = `
        <div class="col-12"><div class="alert alert-warning">
          No hay productos para mostrar.
        </div></div>`;
      return;
    }

    let html = "";
    productos.forEach(p => {
      const enOferta = p.EnOferta && p.PrecioOferta != null;
      const precioHTML = enOferta
        ? `<span class="text-danger">$${parseFloat(p.PrecioOferta).toFixed(2)}</span>
           <small class="text-muted text-decoration-line-through ms-1">$${parseFloat(p.Precio).toFixed(2)}</small>`
        : `$${parseFloat(p.Precio).toFixed(2)}`;

      html += `
        <div class="col-sm-12 col-md-4 mb-4" data-cat="todos">
          <div class="card h-100">
            <img src="${p.Imagen}" class="card-img-top img-fluid" alt="${p.Nombre || 'Producto'}">
            <div class="card-body d-flex flex-column">
              <h6 class="card-title">${p.Nombre ?? ''}</h6>
              <p class="card-text small mb-2">${p.Descripcion ?? ''}</p>
              <p class="fw-bold mb-3">${precioHTML}</p>
              <button class="btn btn-primary mt-auto agregar-carrito">Agregar al carrito</button>
            </div>
          </div>
        </div>`;
    });

    contenedor.innerHTML = html;

    
  } catch (err) {
    console.error("Error al cargar productos:", err);
    contenedor.innerHTML = `
      <div class="col-12"><div class="alert alert-danger">
        No se pudieron cargar los productos.
      </div></div>`;
  }
})();

async function cargarCategorias() {
                try {
                    const response = await fetch("https://backcvbgtmdesa.azurewebsites.net/api/categorias");
                    if (!response.ok) {
                        throw new Error( ' HTTP error! status: ${response.status} ') ;
                    }
                    const categorias = await response.json();
                    const listaCategorias = document.querySelector(".list-group");
                    categorias.forEach(categoria => {
                        const li = document.createElement("li");
                        li.className = "list-group-item";
                        li.innerHTML =  ' <a href="#" class="text-decoration-none text-dark">${categoria.descripcion}</a> ' ;
                        listaCategorias.appendChild(li);
                    });
                } catch (error) {
                    console.error("Error al cargar categorías:", error);
                }
            }

            cargarCategorias();
</script>

</body>
</html>
